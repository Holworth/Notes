计算机网络实验报告
--------------------

实验一
===============

* 王华强
* 2016K8009929035

---

[TOC]

# 互联网协议实验

<!-- 在节点h1上开启wireshark抓包，用wget下载www.baidu.com页面
调研说明wireshark抓到的几种协议
ARP, DNS, TCP, HTTP
调研解释h1下载baidu页面的整个过程
几种协议的运行机制 -->

## 关键协议说明 

访问网站的过程中主要涉及以下几种协议:

ARP, DNS, TCP, HTTP

ARP: 地址解析协议, 根据IP地址获取物理地址(mac地址)
DNS: 域名解析协议, 提供域名到IP地址的映射
TCP: 传输控制协议, 支持在不可靠的网络上进行可靠的传输
HTTP: 超文本传输协议, 无状态的请求-响应协议, 支持WWW服务器与浏览器之间的信息传输

~~详细说明也没什么好讲的, just ctrl-C from wiki~~

## 下载页面的整个过程

wireshark报告中的关键部分如下:

```
通过ARP协议寻找IP地址对应的mac地址
---

本地客户端向DNS服务器发送DNS请求, 查找域名"www.qq.com"对应的ip地址
"1","0.000000000","10.0.0.1","1.2.4.8","DNS","72","Standard query 0x252b A www.qq.com"

DNS服务器回复DNS查询结果
"4","0.008529927","1.2.4.8","10.0.0.1","DNS","153","Standard query response 0x252b A www.qq.com CNAME public.sparta.mig.tencent-cloud.net A 

TCP链接建立的三次握手, 执行完成后"10.0.0.1","220.194.111.148"之间建立TCP链接
"5","0.008731634","10.0.0.1","220.194.111.148","TCP","76","57538  >  80 [SYN] Seq=0 Win=42340 Len=0 MSS=1460 SACK_PERM=1 TSval=977480750 TSecr=0 WS=512"
"6","0.016290606","220.194.111.148","10.0.0.1","TCP","60","80  >  57538 [SYN, ACK] Seq=0 Ack=1 Win=65535 Len=0 MSS=1460"
"7","0.016310539","10.0.0.1","220.194.111.148","TCP","56","57538  >  80 [ACK] Seq=1 Ack=1 Win=42340 Len=0"

----------------------此后TCP链接已建立--------------------------
本地计算机通过TCP协议(以下省略)向服务器发送HTTP-GET请求 (HTTP协议)
"8","0.016395624","10.0.0.1","220.194.111.148","HTTP","193","GET / HTTP/1.1 "

服务器响应请求
"10","0.026757676","220.194.111.148","10.0.0.1","HTTP","397","HTTP/1.1 302 Moved Temporarily  (text/html)"
......

安全传输层协议TLS握手开始, 用于处理"www.qq.com"上账号登陆等功能
"15","0.043728235","10.0.0.1","220.194.111.148","TLSv1.2","251","Client Hello"
"17","0.052984455","220.194.111.148","10.0.0.1","TLSv1.2","2896","Server Hello"
.......
```

# 流完成时间实验

<!-- 利用fct_exp.py脚本复现P25中的图
每个数据点做5次实验，取均值
调研解释图中的现象
提示：TCP传输、慢启动机制 -->

## 数据整理

批量测试的结果如下:

```
aw@aw-VirtualBox:~$ sudo python ./fct_exp.py 10 10ms
('1mb totally cost', 0.04372382164001465)
('10mb totally cost', 8.870406150817871)
('100mb totally cost', 88.52204585075378)
aw@aw-VirtualBox:~$ sudo python ./fct_exp.py 10 100ms
('1mb totally cost', 2.1163368225097656)
('10mb totally cost', 9.894367933273315)
('100mb totally cost', 89.29427790641785)
aw@aw-VirtualBox:~$ sudo python ./fct_exp.py 50 10ms
('1mb totally cost', 0.04538893699645996)
('10mb totally cost', 1.9112670421600342)
('100mb totally cost', 18.24047303199768)
aw@aw-VirtualBox:~$ sudo python ./fct_exp.py 50 100ms
('1mb totally cost', 1.8329260349273682)
('10mb totally cost', 3.2963380813598633)
('100mb totally cost', 19.404229879379272)
aw@aw-VirtualBox:~$ sudo python ./fct_exp.py 100 10ms
('1mb totally cost', 0.046257972717285156)
('10mb totally cost', 1.047043800354004)
('100mb totally cost', 9.374485969543457)
aw@aw-VirtualBox:~$ sudo python ./fct_exp.py 100 100ms
('1mb totally cost', 1.8440830707550049)
('10mb totally cost', 2.6419339179992676)
('100mb totally cost', 10.86581802368164)
aw@aw-VirtualBox:~$ sudo python ./fct_exp.py 500 10ms
('1mb totally cost', 0.04406595230102539)
('10mb totally cost', 0.3939189910888672)
('100mb totally cost', 2.1100170612335205)
aw@aw-VirtualBox:~$ sudo python ./fct_exp.py 500 100ms
('1mb totally cost', 1.8207671642303467)
('10mb totally cost', 2.2744178771972656)
('100mb totally cost', 4.563926935195923)
aw@aw-VirtualBox:~$ sudo python ./fct_exp.py 1000 10ms
('1mb totally cost', 0.04427504539489746)
('10mb totally cost', 0.38527703285217285)
('100mb totally cost', 1.356823205947876)
aw@aw-VirtualBox:~$ sudo python ./fct_exp.py 1000 100ms
('1mb totally cost', 1.8226890563964844)
('10mb totally cost', 2.2638978958129883)
('100mb totally cost', 4.501029014587402)
```

整理后的数据及图表请参见`/data/wget.xlsx`

## 实验现象

不难看出, 对于较小的文件大小, 延迟对于总传输时间的影响很大. 对于较大的文件大小, 带宽的影响更大.

从`wget`显示出的传输速率可以看出, 传输的速率由0开始逐渐增大. 带宽决定了传输速率的上限, 而延迟决定了传输速率的增长速度.

## 解释说明

TCP协议的详细细节从略.

传输速率的增长模式来源于TCP传输拥塞算法与慢启动机制. 慢启动机制是为了防止在连接启动时发送方窗口较大导致大量数据同时发送阻塞网络. 首先, TCP协议发送方处存在拥塞窗口. 在链接刚刚建立的情况下, 拥塞窗口很小, 随着包的成功传输确认拥塞窗口指数增长, 在超时出现后设置慢启动阈值, 减小拥塞窗口大小后进行指数(慢启动阈值前)-线性(慢启动阈值后)增长, 如此反复(拥塞窗口大小逐渐趋于稳定). 带宽的大小最终物理上限制了传输速度的峰值. 而较大的延迟导致启动阶段经常超时, 窗口增大缓慢, 影响传输效率的增长速度.

在文件较小时, 可以看出, 传输并没有达到峰值速度即停止. 增大带宽可以提高峰值速度, 但对于较小的文件却无能为力, 传输速度与带宽不成线性关系, 在带宽增大到一定程度后增长缓慢. 在文件变大以后, TCP逐渐达到峰值速度, 带宽对于传输速度的影响显示出来, 带宽增长与速度增长趋向于线性关系.

比较delay=10/100ms的结果可以看出, delay较高时, 会影响传输的峰值速度.

<!-- tar zcvf xxx.tar.gz dirname -->

# 附件: 完整实验结果

## wireshark抓包结果

```
"No.","Time","Source","Destination","Protocol","Length","Info"
"1","0.000000000","10.0.0.1","1.2.4.8","DNS","72","Standard query 0x252b A www.qq.com"
"2","0.001818464","10.0.0.1","1.2.4.8","DNS","72","Standard query 0xab31 AAAA www.qq.com"
"3","0.007015807","1.2.4.8","10.0.0.1","DNS","177","Standard query response 0xab31 AAAA www.qq.com CNAME public.sparta.mig.tencent-cloud.net AAAA 2402:4e00:8010::155 AAAA 2402:4e00:8010::154"
"4","0.008529927","1.2.4.8","10.0.0.1","DNS","153","Standard query response 0x252b A www.qq.com CNAME public.sparta.mig.tencent-cloud.net A 220.194.111.148 A 220.194.111.149"
"5","0.008731634","10.0.0.1","220.194.111.148","TCP","76","57538  >  80 [SYN] Seq=0 Win=42340 Len=0 MSS=1460 SACK_PERM=1 TSval=977480750 TSecr=0 WS=512"
"6","0.016290606","220.194.111.148","10.0.0.1","TCP","60","80  >  57538 [SYN, ACK] Seq=0 Ack=1 Win=65535 Len=0 MSS=1460"
"7","0.016310539","10.0.0.1","220.194.111.148","TCP","56","57538  >  80 [ACK] Seq=1 Ack=1 Win=42340 Len=0"
"8","0.016395624","10.0.0.1","220.194.111.148","HTTP","193","GET / HTTP/1.1 "
"9","0.016916762","220.194.111.148","10.0.0.1","TCP","56","80  >  57538 [ACK] Seq=1 Ack=138 Win=65535 Len=0"
"10","0.026757676","220.194.111.148","10.0.0.1","HTTP","397","HTTP/1.1 302 Moved Temporarily  (text/html)"
"11","0.026763809","10.0.0.1","220.194.111.148","TCP","56","57538  >  80 [ACK] Seq=138 Ack=342 Win=41999 Len=0"
"12","0.034062475","10.0.0.1","220.194.111.148","TCP","76","39870  >  443 [SYN] Seq=0 Win=42340 Len=0 MSS=1460 SACK_PERM=1 TSval=977480775 TSecr=0 WS=512"
"13","0.043496357","220.194.111.148","10.0.0.1","TCP","60","443  >  39870 [SYN, ACK] Seq=0 Ack=1 Win=65535 Len=0 MSS=1460"
"14","0.043512391","10.0.0.1","220.194.111.148","TCP","56","39870  >  443 [ACK] Seq=1 Ack=1 Win=42340 Len=0"
"15","0.043728235","10.0.0.1","220.194.111.148","TLSv1.2","251","Client Hello"
"16","0.044089005","220.194.111.148","10.0.0.1","TCP","56","443  >  39870 [ACK] Seq=1 Ack=196 Win=65535 Len=0"
"17","0.052984455","220.194.111.148","10.0.0.1","TLSv1.2","2896","Server Hello"
"18","0.052990433","10.0.0.1","220.194.111.148","TCP","56","39870  >  443 [ACK] Seq=196 Ack=2841 Win=41180 Len=0"
"19","0.053495244","220.194.111.148","10.0.0.1","TCP","1312","443  >  39870 [PSH, ACK] Seq=2841 Ack=196 Win=65535 Len=1256 [TCP segment of a reassembled PDU]"
"20","0.053513734","10.0.0.1","220.194.111.148","TCP","56","39870  >  443 [ACK] Seq=196 Ack=4097 Win=41180 Len=0"
"21","0.055538062","220.194.111.148","10.0.0.1","TCP","1416","443  >  39870 [PSH, ACK] Seq=4097 Ack=196 Win=65535 Len=1360 [TCP segment of a reassembled PDU]"
"22","0.055542642","10.0.0.1","220.194.111.148","TCP","56","39870  >  443 [ACK] Seq=196 Ack=5457 Win=41180 Len=0"
"23","0.060599797","220.194.111.148","10.0.0.1","TLSv1.2","760","Certificate, Server Key Exchange, Server Hello Done"
"24","0.060608029","10.0.0.1","220.194.111.148","TCP","56","39870  >  443 [ACK] Seq=196 Ack=6161 Win=41180 Len=0"
"25","0.061716498","10.0.0.1","220.194.111.148","TLSv1.2","174","Client Key Exchange, Change Cipher Spec, Encrypted Handshake Message"
"26","0.062513209","220.194.111.148","10.0.0.1","TCP","56","443  >  39870 [ACK] Seq=6161 Ack=314 Win=65535 Len=0"
"27","0.070809318","220.194.111.148","10.0.0.1","TLSv1.2","306","New Session Ticket, Change Cipher Spec, Encrypted Handshake Message"
"28","0.071215976","10.0.0.1","220.194.111.148","TLSv1.2","214","Application Data"
"29","0.071673622","220.194.111.148","10.0.0.1","TCP","56","443  >  39870 [ACK] Seq=6411 Ack=472 Win=65535 Len=0"
"30","0.085325314","220.194.111.148","10.0.0.1","TCP","2776","443  >  39870 [PSH, ACK] Seq=6411 Ack=472 Win=65535 Len=2720 [TCP segment of a reassembled PDU]"
"31","0.085333197","10.0.0.1","220.194.111.148","TCP","56","39870  >  443 [ACK] Seq=472 Ack=9131 Win=41180 Len=0"
"32","0.086777832","220.194.111.148","10.0.0.1","TCP","10936","443  >  39870 [PSH, ACK] Seq=9131 Ack=472 Win=65535 Len=10880 [TCP segment of a reassembled PDU]"
"33","0.086796531","10.0.0.1","220.194.111.148","TCP","56","39870  >  443 [ACK] Seq=472 Ack=20011 Win=41180 Len=0"
"34","0.092987751","220.194.111.148","10.0.0.1","TCP","1416","443  >  39870 [PSH, ACK] Seq=20011 Ack=472 Win=65535 Len=1360 [TCP segment of a reassembled PDU]"
"35","0.095559134","220.194.111.148","10.0.0.1","TLSv1.2","11416","Application Data [TCP segment of a reassembled PDU]"
"36","0.095583341","10.0.0.1","220.194.111.148","TCP","56","39870  >  443 [ACK] Seq=472 Ack=32731 Win=35500 Len=0"
"37","0.095689998","10.0.0.1","220.194.111.148","TCP","56","57538  >  80 [FIN, ACK] Seq=138 Ack=342 Win=41999 Len=0"
"38","0.096049691","220.194.111.148","10.0.0.1","TCP","2296","443  >  39870 [PSH, ACK] Seq=32731 Ack=472 Win=65535 Len=2240 [TCP segment of a reassembled PDU]"
"39","0.096056512","10.0.0.1","220.194.111.148","TCP","56","39870  >  443 [ACK] Seq=472 Ack=34971 Win=41180 Len=0"
"40","0.096050699","220.194.111.148","10.0.0.1","TCP","56","80  >  57538 [ACK] Seq=342 Ack=139 Win=65535 Len=0"
"41","0.102879153","220.194.111.148","10.0.0.1","TCP","56","80  >  57538 [FIN, ACK] Seq=342 Ack=139 Win=65535 Len=0"
"42","0.102901809","10.0.0.1","220.194.111.148","TCP","56","57538  >  80 [ACK] Seq=139 Ack=343 Win=41999 Len=0"
"43","0.105690422","220.194.111.148","10.0.0.1","TLSv1.2","5496","Application Data [TCP segment of a reassembled PDU]"
"44","0.105708429","10.0.0.1","220.194.111.148","TCP","56","39870  >  443 [ACK] Seq=472 Ack=40411 Win=38340 Len=0"
"45","0.108075249","220.194.111.148","10.0.0.1","TCP","10936","443  >  39870 [PSH, ACK] Seq=40411 Ack=472 Win=65535 Len=10880 [TCP segment of a reassembled PDU]"
"46","0.108090047","10.0.0.1","220.194.111.148","TCP","56","39870  >  443 [ACK] Seq=472 Ack=51291 Win=41180 Len=0"
"47","0.112198889","220.194.111.148","10.0.0.1","TCP","1416","443  >  39870 [PSH, ACK] Seq=51291 Ack=472 Win=65535 Len=1360 [TCP segment of a reassembled PDU]"
"48","0.113516248","220.194.111.148","10.0.0.1","TLSv1.2","1216","Application Data"
"49","0.113521307","10.0.0.1","220.194.111.148","TCP","56","39870  >  443 [ACK] Seq=472 Ack=53811 Win=46860 Len=0"
"50","0.114224161","10.0.0.1","220.194.111.148","TCP","56","39870  >  443 [FIN, ACK] Seq=472 Ack=53811 Win=46860 Len=0"
"51","0.116137006","220.194.111.148","10.0.0.1","TCP","56","443  >  39870 [ACK] Seq=53811 Ack=473 Win=65535 Len=0"
"52","0.123670915","220.194.111.148","10.0.0.1","TCP","56","443  >  39870 [FIN, ACK] Seq=53811 Ack=473 Win=65535 Len=0"
"53","0.123693403","10.0.0.1","220.194.111.148","TCP","56","39870  >  443 [ACK] Seq=473 Ack=53812 Win=46860 Len=0"
```