操作系统研讨课实验
--------------------

Project 4: Virtual Memory Management
=================================


* 王华强
* 中国科学院大学
* 2016K8009929035
* wanghuaqiang16@mails.ucas.ac.cn
* 文档版本: 2018.12.4

---

# 1. 目录

Project 4 Virtual Memory设计文档
中国科学院大学
[姓名] 
[日期] 
1.	内存管理设计
请至少包含以下内容
（1）你设计的页表项包含哪些内容？页表本身使用什么数据结构保存？
（2）任务1和任务2中各自初始化了多少个页表项，以及使用了多少个物理页框保存页表？
（3）任务2和任务3中，进程的用户态栈的起始地址各是多少，栈空间各是多大？
（4） 任务1和任务2中你设计的操作系统实际通过页表可以访问到的物理内存有多大？ 
（5）TLB miss何时发生？在任务2中，你处理TLB miss的流程是怎样的？
（6）设计或实现过程中遇到的问题和得到的经验（如果有的话可以写下来，不是必需项）


2.	缺页处理设计
请至少包含以下内容
（1）何时会发生缺页处理？你设计的缺页处理流程是怎样的，此处的物理页分配策略是什么？
（2）你设计中哪些页属于pinning pages？你实现的页替换策略是怎样的？ 
（3）设计或实现过程中遇到的问题和得到的经验（如果有的话可以写下来，不是必需项）

3.	Bonus设计
请至少包含以下内容
（1）Bonus中你设计的操作系统通过页表访问的可用物理内存是多少？何时会触发swap操作？swap操作是由专门的进程完成么？
（2）你设计的页替换策略是怎样的，有什么优势和不足么？
（3）你设计的测试用例是怎样的？ 
（4）设计或实现过程中遇到的问题和得到的经验（如果有的话可以写下来，不是必需项）

4.	关键函数功能
请列出上述各项功能设计里，你觉得关键的函数，及其作用


参考文献
[1]	[单击此处键入参考文献内容]


本次实验中的主要问题有:

TLB例外处理笔误
SYSCALL_RESTORE_CONTEXT

TLB命中时返回0
开发板地址空间的问题

内核栈栈指针的设置引起系统崩溃

改进方案: 在操作系统启动时分配全局变量空间, 减小SD卡读写操作所造成的性能损失.

使用改进方案时, 操作系统启动后的第一件事是刷新内存分配全局变量空间. Bootloader只需要装载操作系统的代码即可. 为了便于实现, 可以规定一个适中的"装载体积", 将"装载体积"之后的全局变量全都交由操作系统自行刷新.

经测试不太好使.

TODO: L2 page table switch

---

Copyright (C) 2018 Huaqiang Wang