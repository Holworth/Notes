---
title: OS Homework12_13
---


# 操作系统 作业11, 12

* 王华强
* 2016K8009929035

***

# 作业11

## 1. 

每ms传输速率: 15000/60000*1MB=256KB/ms

平均旋转时间: 60000/15000/2=2ms

实质上, 在所有传输中, 均是旋转和寻道时间占主体:

* 512B: (512B)/(2+6+0.002)ms=62.5Bpms
* 1KB: (1KB)/(2+6+0.004)ms=124.9Bpms
* 4KB: (4KB)/(2+6+0.016)ms=499.0Bpms

---

## 2.

### 1)

可索引的总块数为:

10+2^10+2^20+2^30

可索引的最大大小为:

4K*(10+2^10+2^20+2^30)=40K+4M+4G+4T

### 2)

按上面的式子, 需要2级.

有1个一级间接地址块(4M), 还余下约1020M.

有1个二级间接地址块的第一级块.

二级间接地址块的第二级块每个对应4M, 需要1020/4=255个.

综上共计257个.

### 3)

三级.

考察文件的尾端部分:

2G-4M-40K=2044K

2044K / 4K = 511个指针

等级|个数
-|-
一级|1
二级-1|1
二级-2|2^10
三级-1|1
三级-2|2
三级-3|2^10+511

共计2564个.

### 4)

对应各个块的指针分布规律如下:

10-1024-2^20-2^20

第2000000块在三级简址块的第1998966块.

1998966/2^20=1.9

1998966%2^20=950390

950390/2^10=928.11

950390%2^10=118

综上: 在第三级间接地址块的第一级第二块, 第二级第929块, 第三级第119个直接指针(从1开始计数)(偏移量128)上.

---

## 3.

5ms+4ms+8KB/(80KB/ms)=9.1ms

16GB/2/4KB*9.1ms=19084s

(WTF the result is....)

---

## 4.

1/4

更...高?

对于较大的文件来说, 其磁盘使用率近乎是100%. 题中所给的1KB是"文件的中位大小", 那么我们有理由相信, 此系统中1KB的大文件还是为数不少的, 也就是说实际上可能有很多占用多个块的大文件存在. 这些大文件的存在拉高了硬盘利用率.








---

# 作业12

## 1. 

### 1)

在写穿透的情况下, 每次更新内存中的缓存都要直接进行磁盘写入操作.

题目理解成: 有10000次读操作和3000次写操作. 

10000次读写:

<!-- 每次读写首先读取内存中的文件描述符(除了第一次打开文件时), 之后读取文件块的内容, 读取成功之后依次写回文件内容, inode, 更新目录项, 更新目录inode. -->

共计一次读四次写, 读操作有60%概率命中缓存, 10000次读共计4000次读IO.

3000次写均会有IO请求;

综上, 计4000次读, 3000次写, 7000次IO.

### 2)

在write back的情况下, 根据60%的缓存命中率, 我们有:

读操作有60%概率命中缓存, 共计4000次读IO, 1200次写.

计5200次IO.

<!-- 3000次写依次写回文件内容, inode, 更新目录项, 更新目录inode. 共计4800次写; -->

---

## 2.

### 1)

因为是首次打开, 所以需要: 

1. 读取inode"/" 
1. 读取目录项"/"
1. 读取inode"home" 
1. 读取目录项"home"
1. 读取inode"OS18" 
1. 读取目录项"OS18"
1. 读取inode"fs01.pdf"
1. 读取文件"fs01.pdf"

计8个.

### 2)

无需读取, 此文件和对应目录已经被缓存

### 3)

用户B打开时需要校验用户B的权限. 但对应的文件和对应目录已经被缓存, 因此无需读取.

### 4)

打开的fs03.pdf是新的文件, 因此需要读取新的inode和文件block (2)

计2个.

---

## 3. 

这段代码在每次循环中向文件写入长度为4char的内容. 循环共计1000次, 因此文件的总长度为4000B.

在没有缓存的情况下, 每次循环写一次磁盘, 共计1000次. 每次写入4096B

在有缓存的情况下(假定允许写缓冲write back), 缓冲区一直没有被填满填满. 因此需要1次. 这一次写入了4096B

---

## 4.

(问题: 是否需要递归修改父目录的时间戳?)

<!-- 1. 写文件 fs03.pdf -->
1. 写inodemap fs03.pdf
1. 写inode fs03.pdf
1. 写目录项 OS18
1. 写inode OS18

共计4个.

<!-- 无|写文件 fs03.pdf -->
此时宕机会发生的不一致|正在执行的操作
-|-
无|写inode fs03.pdf
inode会被覆盖(未分配bitmap)|写inodemap fs03.pdf
出现无主的inode, 文件可能无法被正常索引到|写目录项 OS18
OS18inode未完成更改, inode中的时间戳等可能不对|写inode OS18


---

Copyright (C) 2018 Wang Huaqiang